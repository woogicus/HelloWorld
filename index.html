<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Soul-grinder by woogicus</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper" id="gameZone">
    	<script type="text/javascript" src="phaser.js"></script>
    	<script src="//cdn.jsdelivr.net/phaser/2.2.2/phaser.min.js"></script>
     	<script type="text/javascript" src="main.js"></script>
	<header> <h1 style="text-align:center"> Soul Grinder </h1></header>
<script type="text/javascript">

var game = new Phaser.Game(1200, 600, Phaser.AUTO, 'gameZone', { preload: preload, create: create, update: update });

function preload() {
	game.load.spritesheet('basicButton', './flixel-button.png', 80, 20);
}

var countText; 
var perSecondText;
var cursorButton; var cursorButtonText;
function create() {
	game.stage.backgroundColor = 0x8d8d8d;
	//Souls count in the center.
	countText = game.add.text(600, 300, 'Souls: 0', { fontSize: '48px', fill: '#000', align: "center"});
	perSecondText = game.add.text(600, 350, 'Per Second: 0.5', { fontSize: '16px', fill: '#000', align: "center" });
	//Building buttons and corresponding text.
	cursorButton = game.add.button(950, 120, 'basicButton', buyCursor, this, 2, 1, 0);
	cursorButton.scale.setTo(2.5, 2.5);
	var style = { font: "16px Arial", fill: "#004444", wordWrap: true, wordWrapWidth: cursorButton.width, align: "center" };

	cursorButtonText = game.add.text(0, 0, "- Cursors      1" + "/nCost: 10", style);
	cursorButtonText.x = Math.floor(cursorButton.x);
    	cursorButtonText.y = Math.floor(cursorButton.y + 30);
}

//Building values that need saved: Count, base production, production multiplier.
var soulsCount = 0;
var cursors = 1;
var cursorProd = 0.5;
var cursorMulti = 1;
var farms = 0;
var farmProd = 3;
var farmMulti = 1;
// Building values that don't need saved: Base building cost, total production amount
var cursorBaseCost = 9;
var farmBaseCost = 50;
var totalProd = 0;
var tickInterval= Phaser.Timer.SECOND;  // Modifiable by upgrades.
var gameTick = Phaser.Timer.SECOND / 5;	    // The "master" game speed.
var autoSave = -1;

//Main game stuff.  Basic increment function, window update interval, number printing.
function update() {
	game.time.events.loop(gameTick, incrementByProd, this);
    	
}


function incrementByProd(){
	//cookieClick(cursors);	
	calcTotalProd();
	soulsCount = soulsCount + (totalProd * (gameTick / tickInterval)); //Increment total souls
	countText.text = 'Souls: ' + prettify(soulsCount);		   //Update running counter
	perSecondText.text = 'Per Second: ' + prettify(totalProd);
	//document.getElementById("cookies").innerHTML = prettify(cookies);
	//document.getElementById("cps").innerHTML = totalProd;

}

function calcTotalProd(){
	totalProd = (cursorProd * cursorMulti * cursors) + (farmProd * farmMulti * farms);
}

function prettify(input){
    var output = Math.round(input * 1000000)/1000000;
	return output;
}

//Building button text and purchase functions.
function resetButtons(){
	// Update button text
	var nextCost = Math.floor(9 * Math.pow(1.15,cursors));       //works out the cost of the next cursor
    	cursorButtonText.text = "Cursors: " + cursors + "  Cost: " + nextCost; //Display on button text
	nextCost = Math.floor(50 * Math.pow(1.15,farms));            //Same for farms          
	farmButtonText.text = "Farms: " + cursors + "  Cost: " + nextCost; 
}

function buyCursor(){
    var cursorCost = Math.floor(cursorBaseCost * Math.pow(1.15,cursors));     //works out the cost of this cursor
    if(soulsCount >= cursorCost){                                   //checks that the player can afford the cursor
        cursors++;                                               //increases number of cursors
    	soulsCount = soulsCount - cursorCost;                          //removes the cookies spent
		var nextCost = Math.floor(cursorBaseCost * Math.pow(1.15,cursors));       //works out the cost of the next cursor
        	cursorButtonText.text = "Cursors: " + cursors + "  Cost: " + nextCost; 
		countText.text = 'Souls: ' + prettify(soulsCount);
    };
};

function buyFarm(){
    var farmCost = Math.floor (farmBaseCost * Math.pow(1.15,farms));      
    if(soulsCount >= farmCost){                                   
        farms++;                                     
    	cookies = cookies - farmCost;  
		var nextCost = Math.floor(farmBaseCost * Math.pow(1.15,farms));                       
		farmButtonText.text = "Farms: " + cursors + "  Cost: " + nextCost; 
		countText.text = 'Souls: ' + prettify(soulsCount);
    };
};

</script>

    </div>
  </body>
</html>
